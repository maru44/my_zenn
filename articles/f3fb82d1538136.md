---
title: "Goã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç°¡å˜ã«ã™ã‚‹OSSä½œã£ãŸ"
emoji: "ğ“…Ÿ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go", "error", "OSS"]
published: false
---

# Goã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç°¡å˜ã«ã™ã‚‹OSS

ã“ã¡ã‚‰æ€ã„ä»˜ãã§å³èˆˆã§ä½œã‚Šã¾ã—ãŸã€‚
ä»•äº‹å‰ã®æ™‚é–“ã¨ä»•äº‹å¾Œã®æ™‚é–“ã‚’ä½¿ã£ã¦1æ—¥ã§ä½œã£ãŸã®ã§ã€ã¾ã è’ã„éƒ¨åˆ†ã‚‚ã‚ã£ãŸã‚Šãƒ†ã‚¹ãƒˆã‚‚æ›¸ã„ã¦ãªã„ã§ã™
https://github.com/maru44/perr

MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å…¬é–‹ã—ã¦ã„ã¾ã™
èˆˆå‘³ã‚ã‚‹æ–¹ã¯ä½¿ã£ã¦ã¿ã¦ãã ã•ã„
issueå¾…ã£ã¦ã¾ã™!
ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç­‰ã‚‚ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™!

# ä½œã£ãŸèƒŒæ™¯

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«é–‹ç™ºè€…ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã—ã¤ã¤ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)ã«å¯¾ã—ã¦é©ã—ãŸæƒ…å ±ã‚’æä¾›ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ä¾‹ãˆã° `dial tcp 127.0.0.1:3306: connect: connection refused` ã®ã‚ˆã†ãªmysqlã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«ã¯ãã‚Œã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«éœ²å‡ºã•ã›ãŸãã¯ãªã„ã§ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ä¼ãˆã‚‹ã¹ãã¯ `Internal Server Error` ã§ã™ã€‚
é€†ã«ãƒ­ã‚°ãŒ `Internal Server Error` ã ã‘ã ã¨ä½•ãŒåŸå› ãªã®ã‹ä¸€ç›®ã§ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

ã¤ã¾ã‚Šã‚¨ãƒ©ãƒ¼ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãŸã‚ã®é¡”ã¨ã€é–‹ç™ºè€…ã®ãŸã‚ã®é¡”ã‚’ç”¨æ„ã—ã¦ã‚ã’ã‚‹ã¨è‰²ã€…ã¨æ¥½ã«ãªã‚Œã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚
ãã“ã§ãƒ¦ãƒ³ã‚°ã®ãƒšãƒ«ã‚½ãƒŠã«ãªãã‚‰ãˆã¦perrã¨ã„ã†åå‰ã«ã—ã¾ã—ãŸã€‚

## åŠ ãˆã¦

- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«æ¯”è¼ƒãƒ¡ã‚½ãƒƒãƒ‰ `Is()`
- ãƒ­ã‚°ã‚„é€šçŸ¥ã®ãŸã‚ã® `Level` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- è§£æã®ãŸã‚ã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å‡ºåŠ›ãƒ¡ã‚½ãƒƒãƒ‰ `Traces()`
- æ§‹é€ çš„ã«ä¿å­˜ã§ãã‚‹ã‚ˆã†ã« `Map()` ã¨ `Json()` ãƒ¡ã‚½ãƒƒãƒ‰

ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

# ä½¿ã„æ–¹

ã‚¶ãƒƒã‚¯ãƒªã¨è§£èª¬ã—ã¦ã„ãã¾ã™

## æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹

`Wrap`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã™
```go:wrap.go
_, err := strconv.Atoi("sample")
p := perr.Wrap(err, perr.BadRequest) # ãƒ©ãƒƒãƒ—ã™ã‚‹

fmt.Printf("Client: %v\n", p.Output().Error())
fmt.Printf("Developer: %v\n", p.Error())

// å‡ºåŠ›çµæœ
// Client: Bad Request
// Developer: strconv.Atoi: parsing "sample": invalid syntax
```

`WrapithLevel()`ã‚’ä½¿ã†ã¨ç‹¬è‡ªã«ãƒ¬ãƒ™ãƒ«ã‚’ä»˜ä¸ã§ãã¾ã™ã€‚

```go:withlevel.go
l := perr.ErrLevel("Dangerous")

_, err := strconv.Atoi("sample")

// æ™®é€š
p := perr.Wrap(err, perr.BadRequest)
fmt.Printf("Default Level: %v\n", p.Level)

// ãƒ¬ãƒ™ãƒ«ä»˜ä¸
pl := perr.WrapWithLevel(err, perr.BadRequest, l)
fmt.Printf("With Level: %v\n", pl.Level)

// å‡ºåŠ›çµæœ
// Default Level: EXTERNAL ERROR
// With Level: Dangerous
```

## æ–°è¦ã‚¨ãƒ©ãƒ¼
`New`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã™
```go:new.go
err := perr.New("Someone pour coffee into a tea cup", perr.BadRequest)

fmt.Printf("Client: %v\n", err.Output().Error())
fmt.Printf("Developer: %v\n", err.Error())

// å‡ºåŠ›çµæœ
// Client: I'm a teapot
// Developer: I'm a teapot: Someone pour coffee into tea cup.
```

ã¾ãŸã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªç¬¬ä¸‰å¼•æ•°ã‚’ä½¿ã†ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰ãˆã‚‰ã‚Œã¾ã™ã€‚
```go:new2.go
err := perr.New("Someone pour coffee into a tea cup", perr.BadRequest, "Don't pour coffee!")

fmt.Printf("Client: %v\n", err.Output().Error())
fmt.Printf("Developer: %v\n", err.Error())

// å‡ºåŠ›çµæœ
// Client: Don't pour coffee!
// Developer: I'm a teapot: Someone pour coffee into tea cup.
```

ã“ã¡ã‚‰ã‚‚ãƒ©ãƒƒãƒ—ã¨åŒæ§˜`NewWithLevel()`ã‚’ä½¿ã†ã¨ç‹¬è‡ªã«ãƒ¬ãƒ™ãƒ«ã‚’ä»˜ä¸ã§ãã¾ã™ã€‚

## stacktrace

## Map & Json
